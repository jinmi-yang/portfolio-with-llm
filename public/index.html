<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ask Gemini - AI Chat</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #ffffff;
    --text: #1a1a2e;
    --text-sub: #6b7280;
    --primary: #4f46e5;
    --primary-light: #eef2ff;
    --border: #e5e7eb;
    --chat-bg: #f8f9fb;
    --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
    --shadow-lg: 0 10px 25px rgba(0,0,0,0.08);
  }

  body {
    font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
  }

  /* ── NAV ── */
  nav {
    position: sticky; top: 0; z-index: 100;
    background: rgba(255,255,255,0.92);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    padding: 0 32px; height: 60px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .nav-logo {
    display: flex; align-items: center; gap: 10px;
    font-weight: 700; font-size: 16px;
    color: var(--text); text-decoration: none;
  }
  .nav-links { display: flex; align-items: center; gap: 28px; }
  .nav-links a {
    text-decoration: none; color: var(--text-sub);
    font-size: 14px; font-weight: 500; transition: color 0.2s;
  }
  .nav-links a:hover { color: var(--text); }
  .nav-btn {
    background: var(--primary); color: #fff; border: none;
    padding: 8px 20px; border-radius: 8px;
    font-size: 14px; font-weight: 600; cursor: pointer;
  }
  .nav-btn:hover { background: #4338ca; }

  /* ── HERO ── */
  .hero {
    text-align: center; padding: 56px 24px 24px;
    max-width: 820px; margin: 0 auto;
  }
  .hero h1 {
    font-size: clamp(24px, 4vw, 36px); font-weight: 700;
    line-height: 1.3; margin-bottom: 12px;
  }
  .hero p {
    font-size: 15px; color: var(--text-sub);
    max-width: 600px; margin: 0 auto 40px;
  }

  /* ── CHAT ── */
  .chat-container {
    max-width: 760px; margin: 0 auto 40px; padding: 0 24px;
  }
  .chat-box {
    background: var(--chat-bg); border: 1px solid var(--border);
    border-radius: 16px; overflow: hidden; box-shadow: var(--shadow-lg);
  }
  .chat-messages {
    padding: 28px 28px 0; min-height: 120px;
    max-height: 480px; overflow-y: auto;
  }
  .chat-messages::-webkit-scrollbar { width: 6px; }
  .chat-messages::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }

  .greeting { margin-bottom: 20px; }
  .greeting .hi { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
  .greeting .sub { font-size: 15px; color: var(--text-sub); }

  .msg { display: flex; gap: 12px; margin-bottom: 20px; animation: fadeUp 0.3s ease; }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .msg-avatar {
    width: 32px; height: 32px; border-radius: 50%; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 14px; font-weight: 700; color: #fff;
  }
  .msg-user .msg-avatar { background: var(--primary); }
  .msg-ai .msg-avatar { background: linear-gradient(135deg, #4285f4, #ea4335, #fbbc05, #34a853); }
  .msg-content { flex: 1; min-width: 0; }
  .msg-content .name { font-size: 13px; font-weight: 600; margin-bottom: 4px; }
  .msg-content .text {
    font-size: 14.5px; line-height: 1.7; color: #374151;
    word-wrap: break-word; white-space: pre-wrap;
  }
  .msg-content .text p { margin-bottom: 8px; }
  .msg-content .text p:last-child { margin-bottom: 0; }
  .msg-content .text strong { font-weight: 600; }
  .msg-content .text code {
    background: #e5e7eb; padding: 2px 6px; border-radius: 4px;
    font-size: 13px; font-family: 'SF Mono', 'Fira Code', monospace;
  }
  .msg-content .text pre {
    background: #1e1e2e; color: #cdd6f4;
    padding: 14px 18px; border-radius: 8px;
    overflow-x: auto; margin: 8px 0; font-size: 13px; line-height: 1.5;
  }
  .msg-content .text pre code { background: none; padding: 0; color: inherit; }

  .typing-indicator { display: flex; gap: 5px; padding: 4px 0; }
  .typing-indicator span {
    width: 7px; height: 7px; background: #9ca3af;
    border-radius: 50%; animation: bounce 1.4s ease-in-out infinite;
  }
  .typing-indicator span:nth-child(2) { animation-delay: 0.16s; }
  .typing-indicator span:nth-child(3) { animation-delay: 0.32s; }
  @keyframes bounce {
    0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
    40% { transform: scale(1); opacity: 1; }
  }

  .suggestions { display: flex; flex-wrap: wrap; gap: 8px; padding: 0 28px 16px; }
  .chip {
    background: #fff; border: 1px solid var(--border); border-radius: 20px;
    padding: 8px 16px; font-size: 13px; color: var(--text-sub);
    cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px;
  }
  .chip:hover { border-color: var(--primary); color: var(--primary); background: var(--primary-light); }

  .chat-input-area { padding: 12px 16px 16px; border-top: 1px solid var(--border); background: #fff; }
  .input-row {
    display: flex; align-items: flex-end; gap: 10px;
    background: #f3f4f6; border-radius: 12px; padding: 6px 6px 6px 16px;
    border: 2px solid transparent; transition: border-color 0.2s;
  }
  .input-row:focus-within { border-color: var(--primary); }
  .input-row textarea {
    flex: 1; border: none; background: transparent; resize: none;
    font-family: inherit; font-size: 14.5px; line-height: 1.5;
    padding: 8px 0; color: var(--text); outline: none; max-height: 120px;
  }
  .input-row textarea::placeholder { color: #9ca3af; }
  .send-btn {
    width: 36px; height: 36px; border-radius: 10px; border: none;
    background: var(--primary); color: #fff;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; flex-shrink: 0; transition: background 0.2s, transform 0.1s;
  }
  .send-btn:hover { background: #4338ca; }
  .send-btn:active { transform: scale(0.94); }
  .send-btn:disabled { background: #c7d2fe; cursor: not-allowed; }
  .input-hint { text-align: center; font-size: 12px; color: #9ca3af; padding-top: 8px; }

  .error-msg {
    color: #dc2626; font-size: 13px; background: #fef2f2;
    padding: 10px 14px; border-radius: 8px; border: 1px solid #fecaca;
  }

  @media (max-width: 640px) {
    nav { padding: 0 16px; }
    .hero { padding: 36px 16px 16px; }
    .chat-container { padding: 0 12px; }
    .chat-messages { padding: 20px 16px 0; }
    .suggestions { padding: 0 16px 12px; }
    .chat-input-area { padding: 10px 12px 12px; }
    .nav-links { display: none; }
  }
</style>
</head>
<body>

<nav>
  <a href="#" class="nav-logo">
    <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
      <rect width="28" height="28" rx="7" fill="#4f46e5"/>
      <path d="M8 14h12M14 8v12" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/>
    </svg>
    About Jinmi
  </a>
  <div class="nav-links">
    <a href="#">AI Chat</a>
    <a href="#">Portfolio</a>
    <button class="nav-btn">Portfolio</button>
    <button class="nav-btn">New Chat</button>
  </div>
</nav>

<section class="hero">
  <h1>Ask Gemini Questions and Chat with It Free Online</h1>
  <p>Ask questions and get instant, accurate, and smart answers from the Google Gemini AI model.</p>
</section>

<div class="chat-container">
  <div class="chat-box">
    <div class="chat-messages" id="chatMessages">
      <div class="greeting">
        <div class="hi">Hi,</div>
        <div class="sub">What can I do for you today?</div>
      </div>
    </div>

    <div class="suggestions" id="suggestions">
      <div class="chip" onclick="sendSuggestion(this)">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.27 5.82 22 7 14.14 2 9.27l6.91-1.01z"/></svg>
        Write a Shakespearean-style sonnet about smartphones
      </div>
      <div class="chip" onclick="sendSuggestion(this)">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
        Explain quantum computing in simple terms
      </div>
      <div class="chip" onclick="sendSuggestion(this)">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg>
        Help me debug a Python script
      </div>
    </div>

    <div class="chat-input-area">
      <div class="input-row">
        <textarea id="userInput" rows="1" placeholder="Ask Gemini anything..."
          onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
          </svg>
        </button>
      </div>
      <div class="input-hint">Enter to send · Shift + Enter to newline</div>
    </div>
  </div>
</div>

<script>
  let conversationHistory = [];
  let isLoading = false;
  const chatEl = document.getElementById('chatMessages');
  const inputEl = document.getElementById('userInput');
  const sendBtnEl = document.getElementById('sendBtn');

  function autoResize(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 120) + 'px';
  }
  function handleKey(e) {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
  }
  function sendSuggestion(chip) {
    inputEl.value = chip.textContent.trim();
    sendMessage();
  }

  function addMessage(role, content, isError = false) {
    const div = document.createElement('div');
    div.className = `msg msg-${role}`;
    const avatar = role === 'user' ? 'U' : 'G';
    const name = role === 'user' ? 'You' : 'Gemini';
    div.innerHTML = `
      <div class="msg-avatar">${avatar}</div>
      <div class="msg-content">
        <div class="name">${name}</div>
        <div class="text ${isError ? 'error-msg' : ''}">${isError ? content : formatMd(content)}</div>
      </div>`;
    chatEl.appendChild(div);
    chatEl.scrollTop = chatEl.scrollHeight;
  }
  function addTyping() {
    const div = document.createElement('div');
    div.className = 'msg msg-ai'; div.id = 'typingMsg';
    div.innerHTML = `<div class="msg-avatar">G</div>
      <div class="msg-content"><div class="name">Gemini</div>
      <div class="typing-indicator"><span></span><span></span><span></span></div></div>`;
    chatEl.appendChild(div);
    chatEl.scrollTop = chatEl.scrollHeight;
  }
  function removeTyping() { document.getElementById('typingMsg')?.remove(); }

  function formatMd(t) {
    t = t.replace(/```(\w*)\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');
    t = t.replace(/`([^`]+)`/g, '<code>$1</code>');
    t = t.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    t = t.replace(/\*(.+?)\*/g, '<em>$1</em>');
    t = t.split(/\n\n+/).map(p => `<p>${p.trim()}</p>`).join('');
    t = t.replace(/\n/g, '<br>');
    return t;
  }

  async function sendMessage() {
    const text = inputEl.value.trim();
    if (!text || isLoading) return;

    const sug = document.getElementById('suggestions');
    if (sug) sug.style.display = 'none';

    isLoading = true;
    sendBtnEl.disabled = true;
    inputEl.value = '';
    inputEl.style.height = 'auto';

    addMessage('user', text);
    conversationHistory.push({ role: 'user', parts: [{ text }] });
    addTyping();

    try {
      // ★ 서버 프록시를 통해 호출 — API 키가 클라이언트에 노출되지 않음
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages: conversationHistory })
      });

      removeTyping();
      const data = await res.json();

      if (!res.ok) {
        addMessage('ai', data.error || '오류가 발생했습니다.', true);
        conversationHistory.pop();
      } else {
        addMessage('ai', data.reply);
        conversationHistory.push({ role: 'model', parts: [{ text: data.reply }] });
      }
    } catch (e) {
      removeTyping();
      addMessage('ai', `연결 오류: ${e.message}`, true);
      conversationHistory.pop();
    }

    isLoading = false;
    sendBtnEl.disabled = false;
    inputEl.focus();
  }
</script>
</body>
</html>
